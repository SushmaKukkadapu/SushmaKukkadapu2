<!DOCTYPE html>
<html>
   <head>
   <link rel="icon" type="image/png" href="../../artwork/favicon.png">
      <title>Leaderboard</title>
      <link href="css/style.css" rel="stylesheet"/>
      <link href="css/bootstrap.min.css" rel="stylesheet"/>
      <script src="/js/angular.min.js"></script>
      <script src="/js/jquery.min.js"></script>
   </head>
   <body background = "election.jpg">
      <center>
         <h1><b>COLLEGE ELECTIONS</b></h1>
         <h3><em>Compare to find the LEADER!</em></h3>
         <br>
         <div ng-app="TweetSearch" ng-controller="Controller">
            <div class="form-group">
               <div class="input-group" id="searchBar">

                  <table>
                  <tr>
                   <span class="input-group-btn">
                     <button href='#' class="btn btn-default"
                          type="button" id="button"
                          ng-click="Search1(); Search2()">Compare</button>
                  </span>
                  </tr>
                  <tr> 
                    <td><input type="text" id="query1"
                         class="form-control" ng-model="query1"
                         placeholder="Search tweet1"> </td>
                    <td><input type="text" id="query2"
                         class="form-control" ng-model="query2"
                         placeholder="Search tweet2"> </td>
                   </tr>
                   </table>
                  
                  
               </div>
            </div>
            <div ng-if="spinner && !leaderboard1 && !leaderboard2">
                <img src="loading.gif" height="400" width="400"/>
            </div>
            <br>
            <br>
            <br>
            <div class="container">
            <table>
               
               <tr>
               <td>
                  <td>
                  <table>
                  <th style="text-align: center;"><h3><b>{{query1}}</b></h3></th>
                  <tr> 
                  	<td>{{ Search1() }}</td> </tr></table>
                  </td>

                  <td ng-if="leaderboard2">
                  <table>
                  <th style="text-align: center;"><h3><b>{{query2}}</b></h3></th>
                  <tr ng-repeat="value in leaderboard2 | limitTo:5"> 
                  	<td>{{value[0]}} &nbsp;&nbsp; : &nbsp;&nbsp; {{value[1]}}</td> </tr></table>
                  </td>
                  </td>
                  </tr>

            </table>
            
            
            </div>
            </div>
         </div>
         </div>
         </div>
      </center>
      <script>
         var app = angular.module('TweetSearch', []);
         app.controller('Controller', ['$scope', '$http', '$sce', function($scope, $http, $sce) {
              $scope.spinner=true;
             $scope.Search1 = function() {
                var tweetc = 0;
                 var QueryCommand1 = 'http://api.loklak.org/api/search.json?callback=JSON_CALLBACK&q=' + $scope.query1;
                 $http.jsonp(String(QueryCommand1)).success(function(response) {

                     var data = response;
                     var statuses = data.statuses;
                     var users = [];
                     for (var i=0; i<statuses.length; i++) {
                         user = statuses[i].screen_name;
                         users.push(user);
                     }
                     //document.write(users);

                     var counts = {};   
                     
                     for(var i = 0; i< users.length; i++) {
                         var num = users[i];
                         //document.write(num+"^");
                         counts[num] = counts[num] ? counts[num]+1 : 1;
                         tweetc=tweetc+counts[num];
                         
                     }
                     //document.write(tweetc+",");
                     
                     
                     //return tweetc;
                     //console.log(counts);
                 }); 
                 return tweetc;
             }
             $scope.Search2 = function() {
                $scope.spinner=true;
                 var QueryCommand2 = 'http://api.loklak.org/api/search.json?callback=JSON_CALLBACK&q=' +
                                    $scope.query2;
                 $http.jsonp(String(QueryCommand2)).success(function(response) {

                     var data = response;
                     var statuses = data.statuses;
                     var users = [];
                     for (var i=0; i<statuses.length; i++) {
                         user = statuses[i].screen_name;
                         users.push(user);
                     }
                     var counts = {};
                     for(var i = 0; i< users.length; i++) {
                         var num = users[i];
                         counts[num] = counts[num] ? counts[num]+1 : 1;
                     }
                     var countArr = [];
                     for (obj in counts){
                         countArr.push([obj,counts[obj]])
                     }
                     countArr.sort(function(a,b){return b[1] - a[1]});
                     $scope.leaderboard2 = countArr;
                     //console.log(counts);
                 });

             }
             window.addEventListener("keydown",   function flagup(event)
            {
              if(event.key=='Enter')
              {
          		$scope.Search();
              }
            });
              $scope.spinner = false;
         }]);
      </script>
   </body>
</html>
